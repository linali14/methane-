// Methane Molecule (CH4) - Unit 5 Assignment
// ------------------------------------------------------------
// This program creates a 3D model of a methane molecule using
// spheres (atoms), cylinders (bonds), lighting, animation,
// mouse controls, and a green plane to receive shadows.
//
// Technologies used:
// - Three.js
// - OrbitControls for mouse interaction
// ------------------------------------------------------------

// =====================
// SCENE SETUP
// =====================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

// Camera
const camera = new THREE.PerspectiveCamera(
  60, window.innerWidth / window.innerHeight, 0.1, 1000
);
camera.position.set(0, 5, 10);

// Renderer
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true; // Enable shadows
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
document.body.appendChild(renderer.domElement);

// =====================
// LIGHTING
// =====================
// Ambient light for soft global illumination
const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
scene.add(ambientLight);

// Directional light to create shadows
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(5, 10, 5);
directionalLight.castShadow = true;
directionalLight.shadow.mapSize.width = 2048;
directionalLight.shadow.mapSize.height = 2048;
scene.add(directionalLight);

// =====================
// PLANE (GROUND)
// =====================
// Green plane that receives shadows
const planeGeometry = new THREE.PlaneGeometry(30, 30);
const planeMaterial = new THREE.MeshStandardMaterial({
  color: 0x3cb043, // Green
});
const plane = new THREE.Mesh(planeGeometry, planeMaterial);
plane.rotation.x = -Math.PI / 2;
plane.position.y = -2;
plane.receiveShadow = true;
scene.add(plane);

// =====================
// MOLECULE GROUP
// =====================
// Group so ONLY the molecule rotates (not the plane)
const molecule = new THREE.Group();
scene.add(molecule);

// =====================
// MATERIALS
// =====================
// Carbon atom (red)
const carbonMaterial = new THREE.MeshStandardMaterial({
  color: 0xff0000,
});

// Hydrogen atoms (blue)
const hydrogenMaterial = new THREE.MeshStandardMaterial({
  color: 0x0000ff,
});

// Bonds (white with light gray emissive)
const bondMaterial = new THREE.MeshStandardMaterial({
  color: 0xffffff,
  emissive: 0xaaaaaa,
  emissiveIntensity: 0.2,
});

// =====================
// GEOMETRY
// =====================
const carbonGeometry = new THREE.SphereGeometry(1, 32, 32);
const hydrogenGeometry = new THREE.SphereGeometry(0.5, 32, 32);
const bondGeometry = new THREE.CylinderGeometry(0.15, 0.15, 2, 16);

// =====================
// CARBON ATOM
// =====================
const carbon = new THREE.Mesh(carbonGeometry, carbonMaterial);
carbon.castShadow = true;
carbon.receiveShadow = true;
molecule.add(carbon);

// =====================
// HYDROGEN ATOMS POSITIONS (TETRAHEDRAL)
// =====================
const hydrogenPositions = [
  new THREE.Vector3( 2,  2,  2),
  new THREE.Vector3(-2, -2,  2),
  new THREE.Vector3(-2,  2, -2),
  new THREE.Vector3( 2, -2, -2),
];

// =====================
// CREATE HYDROGEN ATOMS AND BONDS
// =====================
hydrogenPositions.forEach(position => {
  // Hydrogen atom
  const hydrogen = new THREE.Mesh(hydrogenGeometry, hydrogenMaterial);
  hydrogen.position.copy(position);
  hydrogen.castShadow = true;
  hydrogen.receiveShadow = true;
  molecule.add(hydrogen);

  // Bond (cylinder)
  const bond = new THREE.Mesh(bondGeometry, bondMaterial);
  bond.castShadow = true;
  bond.receiveShadow = true;

  // Position bond halfway between carbon and hydrogen
  const midPoint = position.clone().multiplyScalar(0.5);
  bond.position.copy(midPoint);

  // Align bond with hydrogen direction
  bond.lookAt(position);
  bond.rotateX(Math.PI / 2);

  molecule.add(bond);
});

// =====================
// ORBIT CONTROLS (MOUSE ROTATION)
// =====================
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;

// =====================
// ANIMATION LOOP
// =====================
function animate() {
  requestAnimationFrame(animate);

  // Rotate ONLY the molecule
  molecule.rotation.y += 0.01;

  controls.update();
  renderer.render(scene, camera);
}

animate();

// =====================
// WINDOW RESIZE HANDLER
// =====================
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
